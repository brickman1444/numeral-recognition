<html>
    <script type="module">

    import numeral_recognition from "./pkg/numeral_recognition.js";

    var canvas = null,
        ctx = null,
        is_mouse_down = false,
        prevX = 0,
        currX = 0,
        prevY = 0,
        currY = 0,
        fill_style = "black",
        line_width = 7,
        w = 0,
        h = 0;

    window.addEventListener('DOMContentLoaded', init); // Run when page loads. We can't use <body onload="init"> with a module script
    
    function init() {

        canvas = document.getElementById('can');
        ctx = canvas.getContext("2d");
        w = canvas.width;
        h = canvas.height;
    
        canvas.addEventListener("mousemove", on_mouse_move, false);
        canvas.addEventListener("mousedown", on_mouse_down, false);
        canvas.addEventListener("mouseup", on_mouse_up, false);
        canvas.addEventListener("mouseout", on_mouse_up, false);

        numeral_recognition();
    }
    
    function draw() {
        ctx.beginPath();
        ctx.moveTo(prevX, prevY);
        ctx.lineTo(currX, currY);
        ctx.strokeStyle = fill_style;
        ctx.lineWidth = line_width;
        ctx.stroke();
        ctx.closePath();
    }
    
    function erase() {
        ctx.clearRect(0, 0, w, h);
    }

    function on_mouse_down(event) {
        currX = event.clientX - canvas.offsetLeft;
        currY = event.clientY - canvas.offsetTop;

        is_mouse_down = true;

        // Immediately draw something in case the mouse is released before it's moved
        ctx.beginPath();
        ctx.fillStyle = fill_style;
        ctx.fillRect(currX, currY, line_width, line_width);
        ctx.closePath();
    }

    function on_mouse_up(event) {
        is_mouse_down = false;
    }
    
    function on_mouse_move(event) {
        if (is_mouse_down) {
            prevX = currX;
            prevY = currY;
            currX = event.clientX - canvas.offsetLeft;
            currY = event.clientY - canvas.offsetTop;
            draw();
        }
    }

    function recognize() {
        console.log("recognize from javascript")
    }
    </script>
    <body>
        <canvas id="can" width="400" height="400" style="border:2px solid;"></canvas>
        </br>
        <input type="button" value="Clear" id="clr" onclick="erase()">
        <input type="button" value="Recognize" id="recognize" onclick="recognize()">
        <div>Recognized Numeral: ?</div>
    </body>
    </html>